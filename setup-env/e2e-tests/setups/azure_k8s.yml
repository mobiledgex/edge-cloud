cluster:
    mexmanifest: "{{datadir}}//cluster-azure-aks.yaml"

#we don't actually know the ip until after it is created, so this is updated
#after and deploy is run a second time.  A better solution TBD
cloudflare:
  zone: mobiledgex.net
  records: 
  - name: mexdemo.dme.mobiledgex.net
    type: A
    content: 40.122.71.185
  - name: mexdemo.tok.mobiledgex.net
    type: A
    content: 40.113.219.126
  - name: mexdemo.locsim.mobiledgex.net
    type: A
    content: 40.113.219.126
  - name: mexdemo.ctrl.mobiledgex.net
    type: A
    content: 104.43.221.230
  - name: mexdemo.ctrl-http.mobiledgex.net
    type: A
    content: 40.122.29.67
  - name: mexdemo.ctrl-not.mobiledgex.net
    type: A
    content: 40.113.245.183
  - name: mobiledgexsdkdemo.centraluscloudlet.tdg.mobiledgex.net
    type: A
    content: 40.113.219.126
  - name: mobiledgexsdkdemo.westuscloudlet.tdg.mobiledgex.net
    type: A
    content: 40.118.185.214
  - name: mobiledgexsdkdemo.bonncloudlet.tdg.mobiledgex.net
    type: A
    content: 37.50.143.101

k8s-deployment:

   - file: rbac.yml
     description: setup permissions for service account

   - file: mex-secret.yml
     description: secret used to access private repo

#   - file: mex-locsim-deploy.yml
#     description: create a location api simulator
#     waitforpods:
#     - podname: locsim
#       podcount: 1
#       maxwait: 180 
#     copyfile:
#       podname: locsim
#      src: ../data/locsim.yml
#      dest: /var/tmp

#   - file: mex-locsim-lb.yml
#     description: create locsim load balancer for external access
     
#   - file: mex-toksrv-deploy.yml
#     description: create token service simulator
#     waitforpods:
#     - podname: toksrv
#       podcount: 1
#       maxwait: 180

#   - file: mex-toksrv-lb.yml
#     description: create a load balancer for token service

   - file: etcd-operator.yml
     description: create an operator deployment to manage etcd
     waitforpods:
      - podname: etcd-operator
        podcount: 1
        maxwait: 180
 
   - file: mex-etcd-cluster.yml
     description: creates the MEX etcd cluster
     waitforpods:
      - podname: mex-etcd-cluster
        podcount: 3 
        maxwait: 180

   - file: mex-controller-deploy.yml
     description: deploys the controllers
     waitforpods:
      - podname: controller
        podcount: 2
        maxwait: 180

   - file: mex-controller-lb.yml
     description: create a load balancer for controllers

   - file: mex-controller-notify-lb.yml
     description: expose controller notify port via lb 

   - file: mex-dme-deploy.yml
     description: deploys the dmes
     waitforpods:
      - podname: dme
        podcount: 2
        maxwait: 180

   - file: mex-dme-lb.yml
     description: create a load balancer for dmes

   - file: mex-crm-deploy-centralus.yml
     description: deploys the cluster in azure central
     waitforpods:
      - podname: crmcentralus
        podcount: 1
        maxwait: 180

   - file: mex-crm-deploy-westus.yml
     description: deploys the cluster in azure west
     waitforpods:
      - podname: crmwestus
        podcount: 1
        maxwait: 180

#   - file: mecrm-deploy-bonn.yml
#     description: deploys the cluster in bonn
#     waitforpods:
#      - podname: crmbonn
#        podcount: 1
#        maxwait: 180

controllers:
- controllerlocal:
    name: ctrl-pool

dmes:
- dmelocal:
    name: dme-pool
    carrier: tdg

crms:
 - crmlocal:
     name: crm-pool
