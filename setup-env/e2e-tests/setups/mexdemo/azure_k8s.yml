cluster:
    mexmanifest: "{{datadir}}//cluster-azure-aks.yaml"

#we don't actually know the ip until after it is created, so this is updated
#after and deploy is run a second time.  A better solution TBD
cloudflare:
  zone: mobiledgex.net
  records: 
  - name: mexdemo.dme.mobiledgex.net
    type: A
    content: 104.43.212.22
  - name: mexdemo.tok.mobiledgex.net
    type: A
    content: 40.113.219.126
  - name: mexdemo.locsim.mobiledgex.net
    type: A
    content: 40.113.219.126
  - name: mexdemo.ctrl.mobiledgex.net
    type: A
    content: 40.122.66.18
  - name: mobiledgexsdkdemomobiledgexsdkdemo10.bonndemocloudlet.tdg.mobiledgex.net
    type: A
    content: 37.50.143.107
  - name: mobiledgexsdkdemofacedetectiondemo10.bonndemocloudlet.tdg.mobiledgex.net
    type: A
    content: 37.50.143.107
  - name: mobiledgexsdkdemomobiledgexsdkdemo10.hamburgdemocloudlet.tdg.mobiledgex.net
    type: A
    content: 80.187.132.8
  - name: mobiledgexsdkdemofacedetectiondemo10.hamburgdemocloudlet.tdg.mobiledgex.net
    type: A
    content: 80.187.132.8
  - name: mobiledgexsdkdemomobiledgexsdkdemo10.berlindemocloudlet.tdg.mobiledgex.net
    type: A
    content: 80.187.128.15
  - name: mobiledgexsdkdemofacedetectiondemo10.berlindemocloudlet.tdg.mobiledgex.net
    type: A
    content: 80.187.128.15
  - name: mobiledgexsdkdemofacedetectiondemo10.microsoftwestus2cloudlet.azure.mobiledgex.net
    type: A
    content: 52.183.46.191
  - name: mobiledgexsdkdemomobiledgexsdkdemo10.microsoftwestus2cloudlet.azure.mobiledgex.net
    type: A
    content: 52.183.46.191
  - name: mobiledgexsdkdemofacedetectiondemo10.microsofteastuscloudlet.azure.mobiledgex.net
    type: A
    content: 168.62.183.61
  - name: mobiledgexsdkdemomobiledgexsdkdemo10.microsofteastuscloudlet.azure.mobiledgex.net
    type: A
    content: 168.62.183.61
  - name: mobiledgexsdkdemofacedetectiondemo10.microsoftnortheuropecloudlet.azure.mobiledgex.net
    type: A
    content: 40.127.161.115
  - name: mobiledgexsdkdemomobiledgexsdkdemo10.microsoftnortheuropecloudlet.azure.mobiledgex.net
    type: A
    content: 40.127.161.115
  - name: mobiledgexsdkdemofacedetectiondemo10.microsoftbaskingridgecloudlet.azure.mobiledgex.net
    type: A
    content: 192.168.104.83
  - name: mobiledgexsdkdemomobiledgexsdkdemo10.microsoftbaskingridgecloudlet.azure.mobiledgex.net
    type: A
    content: 192.168.104.83
  - name: mobiledgexsdkdemofacedetectiondemo10.azcentraluscloudlet.azure.mobiledgex.net
    type: A
    content: 23.99.193.4
  - name: mobiledgexsdkdemomobiledgexsdkdemo10.azcentraluscloudlet.azure.mobiledgex.net
    type: A
    content: 23.99.193.4
  - name: mobiledgexsdkdemofacedetectiondemo10.cmulivingedgecloudlet.tdg.mobiledgex.net
    type: A
    content: 128.2.208.35
  - name: mobiledgexsdkdemomobiledgexsdkdemo10.cmulivingedgecloudlet.tdg.mobiledgex.net
    type: A
    content: 128.2.208.35

  - name: mexdemo.monitor.mobiledgex.net
    type: A
    content: 168.61.152.107

tlscerts:
- commonname: mexdemo
  dnsnames:
    - controller
    - controller-notify
    - mobiledgexsdkdemo.centraluscloudlet.tdg.mobiledgex.net
    - mobiledgexsdkdemo.westuscloudlet.tdg.mobiledgex.net
    - mobiledgexsdkdemo.bonncloudlet.tdg.mobiledgex.net
    - mexdemo.ctrl.mobiledgex.net
    - mexdemo.dme.mobiledgex.net
  ips:
    - 127.0.0.1
    - 0.0.0.0


k8s-deployment:
   - file: rbac.yml
     description: setup permissions for service account

   - file: mex-secret.yml
     description: secret used to access private repo

   - file: etcd-operator.yml
     description: create an operator deployment to manage etcd
     waitforpods:
      - podname: etcd-operator
        podcount: 1
        maxwait: 180
 
   - file: mex-etcd-cluster.yml
     description: creates the MEX etcd cluster
     waitforpods:
      - podname: mex-etcd-cluster
        podcount: 3 
        maxwait: 180

   - file: mex-controller-deploy.yml
     description: deploys the controllers
     waitforpods:
      - podname: controller
        podcount: 1
        maxwait: 180

   - file: mex-controller-lb.yml
     description: create a load balancer for controllers

   - file: mex-dme-deploy.yml
     description: deploys the dmes
     waitforpods:
      - podname: dme
        podcount: 1
        maxwait: 180

   - file: mex-dme-lb.yml
     description: create a load balancer for dmes


controllers:
- controllerlocal:
    name: ctrl-pool
    apiaddr: "0.0.0.0:55001"
    tls:
       servercert: "{{tlsoutdir}}/mex-server.crt"
       clientcert: "{{tlsoutdir}}/mex-client.crt"
  hostname: "mexdemo.ctrl.mobiledgex.net"

dmes:
- dmelocal:
    name: dme-pool
    carrier: tdg
    tls:
       servercert: "{{tlsoutdir}}/mex-server.crt"
       clientcert: "{{tlsoutdir}}/mex-client.crt"

crms:
 - crmlocal:
     name: crm-pool
     tls:
       servercert: "{{tlsoutdir}}/mex-server.crt"
       clientcert: "{{tlsoutdir}}/mex-client.crt"
